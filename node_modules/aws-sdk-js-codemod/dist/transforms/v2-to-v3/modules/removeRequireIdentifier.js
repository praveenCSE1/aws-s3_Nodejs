"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.removeRequireIdentifier = void 0;
const config_1 = require("../config");
const getRequireDeclaratorsWithIdentifier_1 = require("./getRequireDeclaratorsWithIdentifier");
const removeDeclaration_1 = require("./removeDeclaration");
const removeRequireIdentifier = (j, source, { localName, sourceValue }) => {
    const requireDeclarators = (0, getRequireDeclaratorsWithIdentifier_1.getRequireDeclaratorsWithIdentifier)(j, source, {
        identifierName: localName,
        sourceValue,
    });
    requireDeclarators.forEach((varDeclarator) => {
        const varDeclaration = varDeclarator.parentPath.parentPath;
        // Removes variable declarator from the declarations.
        varDeclaration.value.declarations = varDeclaration.value.declarations.filter((declaration) => {
            if (declaration.type === "Identifier")
                return true;
            const id = declaration.id;
            if (id.type !== "Identifier")
                return true;
            if (id.name !== localName)
                return true;
            const init = declaration.init;
            if (!init)
                return true;
            if (init.type !== "CallExpression")
                return true;
            const callee = init.callee;
            if (!callee)
                return true;
            if (callee.type !== "Identifier")
                return true;
            if (callee.name !== "require")
                return true;
            const args = init.arguments;
            if (!args)
                return true;
            if (args.length !== 1)
                return true;
            if (!config_1.STRING_LITERAL_TYPE_LIST.includes(args[0].type))
                return true;
            if (args[0].value !== sourceValue)
                return true;
            return false;
        });
        // Remove VariableDeclaration if there are no declarations.
        if (varDeclaration.value.declarations?.length === 0) {
            (0, removeDeclaration_1.removeDeclaration)(j, source, varDeclaration);
        }
    });
};
exports.removeRequireIdentifier = removeRequireIdentifier;
